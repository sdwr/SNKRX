--------------
NEW FEATURE PLAN:

get the playthrough to be fun:
  - v2 items
    - add item synergies

    - figure out phasing (add new ghost Group for objects)
    - clean up unit stat system
    - pass owner unit to :hit() from helper.spell (already done when possible?)

  - finish level map
    - hover over to see level effects
    - fix change level 
      (performance hit, update buttons instead of destroy/create)

  - change controls, or at least have option
    - 1 troop selected at a time
    - LMB move 
    - shift LMB move to target
    - RMB attack enemy
    - space move all
    
  - add level modifiers (maybe don't need, overlaps with special enemies)
    - berserk
    - infected
    - shielded
    - capture point

  - add passive traits (pick 1 of 3?)
    - lightning damage mult
    - after dealing lightning damage, gain mspd (aspd?) for 3 seconds

    - burn damage lasts longer
    - after dealing burn damage, gain armor for 3 seconds

    - cold slow stacks with itself
    - when a unit affected by cold dies, freeze nearby enemies for 1 second

    - crit chance
    - 

-------------
BUGS:
--------------

crash:
  crash when spawning units inside each other (fixed for boss though?)
  check global GameState references - had a bug trying to set the rallyEffect in the main menu

combat:
  safety dance doesn't damage every time
  ghost units stack ontop of each other
  critters arent affected by slow
  basher doesn't work (black circle)
  buffs with same name don't stack properly (first amt gets duration refreshed)
  buffs aren't the right size on all units (hidden under square, too big around rect)

units:
  rally doesn't work while shooting/about to shoot
  shouldn't be able to push bosses with units
  should be able to hit enemies without needing to hit the exact center (mainly problem with bosses)
  necromancers (+healers?) all target same corpse/unit

shop screen:
  item overlay doesn't work in windowed mode
    - they are an overlay on the game window
    - but are scaled to fullscreen
    - too big and in the wrong place in windowed mode

  items display on top of the settings menu
  items too big coming from shop
  saving/enter arena with item on cursor?
  
  guide/restart buttons hover overlaps troop display

---------------
CODE CLEANUP:
---------------

  - create global list of friendly classes
  - unify target selection, attack triggering
    * need proper lambdas? delayed functions cant have params
  
ui
  - show nice cursor
  - show unit attack CD somehow

shop ui
  - show item cost in corner
  - show troop/item stats without needing to hover

units
  - collision? clustering?
  - add safe unit create that checks for clipping/ finds new spawn
  - turn time
    * already in engine
    * see if attacking requires LoS angle

combat
  - attack timing quantized to beat?
    * classes can have different timings
    * troops within class can be on different sub-beats (1/2/3/4)
    * makes music out of sound effects

---------------
OPTIMIZATION
---------------
stats are recalculated every frame
  switch to "push" system from "pull
  buffs with durations, apply once, then unapply at expiration

lots of n^2 calculations in new spell system
finding targets

------------------
FEATURES:
------------------

tooling:
  one-click builds
  mac/web build?!?!
  debug mode
    fps counter tracks longest frames

items:
  legendary items (T3, T4)
  most of the randomness will be coming from items now, need flashy and strong items for the endgame

  think about unlocking items/classes per run, replayability

items to add:
  damage:
    flat dmg 
    %̶d̶m̶g̶
    %̶a̶s̶p̶d̶
  
  survival:
    v̶a̶m̶p̶
    shield
    a̶r̶m̶o̶r̶/̶h̶p̶

  utility:
    m̶o̶v̶e̶ ̶s̶p̶e̶e̶d̶
̶ ̶ ̶ ̶ ̶g̶h̶o̶s̶t̶ ̶t̶h̶r̶o̶u̶g̶h̶ ̶u̶n̶i̶t̶s̶
̶ ̶ ̶ ̶ ̶b̶a̶s̶h̶e̶r̶
    s̶l̶o̶w̶/̶f̶r̶e̶e̶z̶e̶
    aura

  special:
    revive after death for 5s
̶ ̶ ̶ ̶ ̶t̶h̶o̶r̶n̶s̶
    heal over time
    stim pack

  after death:
    heal allies
    drop bomb
̶ ̶ ̶ ̶ ̶e̶n̶r̶a̶g̶e̶ ̶a̶l̶l̶i̶e̶s̶


level effects 
̶ ̶ ̶e̶g̶g̶,̶ ̶h̶a̶t̶c̶h̶e̶s̶ ̶i̶n̶t̶o̶ ̶l̶o̶t̶s̶ ̶o̶f̶ ̶c̶r̶i̶t̶t̶e̶r̶s̶
  capture point
    capture for team heal
    capture for team aspd
    capture to freeze/damage enemies
      unkillable enemies that need to be wiped with capture point?


allies
  needler 
    shoots clip of bullets in random spray around target
  
  bomb dropper

  engineer
    spawns turret
    


enemies
  add annoying flyers (circle around the arena, tiny projectiles that do not too much damage, small hitbox?, don't collide with objects)
  add horde-type summoner (lots of little fast summons)

  add leapers
  add homing missiler
  add ranged archer

  add minibosses
    scaled up versions of regular casters


  add bosses
  ogre boss, big aoe stomp
  snake boss, burrows into ground / charges?
  heigan, safety dance


  - change spawn logic
    * fixed by level?
    * all at once or over time?

allies

  - healers
  healers should also fight
    paladin: heal and tank
    * d̶i̶s̶c̶ ̶p̶r̶i̶e̶s̶t̶ ̶(̶s̶h̶i̶e̶l̶d̶)̶
    * rejuv (hot)
    * 

  - purple
     * necromancer
      - u̶s̶e̶ ̶c̶r̶i̶t̶t̶e̶r̶ ̶c̶l̶a̶s̶s̶
      - h̶a̶v̶e̶ ̶t̶o̶ ̶a̶d̶d̶ ̶c̶o̶r̶p̶s̶e̶s̶
      - add skeletons to control group?

     * curse explosion (caustic finale)
     * curse dot

  - b̶u̶f̶f̶ ̶t̶y̶p̶e̶s̶
  buffs moved to items
    * aspd aura
    * double spell
    * ̶b̶u̶b̶b̶l̶e̶ ̶a̶l̶l̶y̶ ̶t̶o̶ ̶p̶r̶e̶v̶e̶n̶t̶ ̶d̶e̶a̶t̶h̶
    * bloodlust (+aspd, - armor, aoe?)
  - rogues
    * stealthed unti attacks
    * leaps backline
    * disengage on low hp?

  nuker (orange)
  - cannon
  - flamethrower


  - leaping zergling

tuning
  - movement
    caster enemies shouldn't chase (bullet-hell/spread, summoners)
      maybe move randomly or try to escape

  - triggers
    * enemies should be able to attack on spawn, instead of waiting full cd
      maybe? easily doable with new spell system

  - spells
      * what to do with overheal/multi-bubble/necromancer if multiple caster pick same target
        * fizzle? go on cd?
